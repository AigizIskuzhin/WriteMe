@using Database.DAL.Entities.Messages.ChatMessage
@model Website.ViewModels.Messenger.ChatViewModel
@{
    Layout = null;

    DateTime now = DateTime.Now;
    DateTime lastDay = now;
}
@if (!Model.History.Any())
{
    <li class="message none generated_message">
        <div class="message_content">
            Записей нет
        </div>
    </li>
}
else foreach (var message in Model.History)
{
    var day = message.CreatedDateTime.DayOfYear + 1 == now.DayOfYear ? "Вчера" : message.CreatedDateTime.ToString("M");
        if (message is ParticipantChatMessage userMessage)
            await Html.RenderPartialAsync("PrivateChat/PrivateChatMessageView", userMessage, ViewData);
        else if(message is GeneratedChatMessage generatedMessage)
            await Html.RenderPartialAsync("Base/MessageView", generatedMessage);
        
        if (lastDay.DayOfYear != message.CreatedDateTime.DayOfYear && now.DayOfYear != message.CreatedDateTime.DayOfYear)
        {
            <li class="message generated_message day">
                <div class="message-content">
                    @day
                </div>
            </li>
            lastDay = message.CreatedDateTime;
        }
    }